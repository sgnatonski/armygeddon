var BinaryHeap=function(t){this.content=[],this.scoreFunction=t};BinaryHeap.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),i=this.content.pop();e!==this.content.length-1&&(this.content[e]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var i=(t+1>>1)-1,n=this.content[i];if(!(this.scoreFunction(e)<this.scoreFunction(n)))break;this.content[i]=e,this.content[t]=n,t=i}},bubbleUp:function(t){for(var e=this.content.length,i=this.content[t],n=this.scoreFunction(i);;){var r,o=t+1<<1,h=o-1,s=null;if(h<e){var a=this.content[h];(r=this.scoreFunction(a))<n&&(s=h)}if(o<e){var x=this.content[o];this.scoreFunction(x)<(null===s?n:r)&&(s=o)}if(null===s)break;this.content[t]=this.content[s],this.content[s]=i,t=s}}};var BHex=BHex||{};BHex.Axial=function(t,e){this.x=t,this.y=e},BHex.Axial.prototype.getKey=function(){return this.x+"x"+this.y},BHex.Axial.prototype.toCube=function(){return new BHex.Cube(this.x,-this.x-this.y,this.y)},BHex.Axial.prototype.compareTo=function(t){return this.x==t.x&&this.y==t.y},BHex.Cube=function(t,e,i){BHex.Axial.call(this,t,e),this.z=i||-t-e},BHex.Cube.prototype=BHex.Axial.prototype,BHex.Cube.prototype.toAxial=function(){return new BHex.Axial(this.x,this.z)},BHex.Hexagon=function(t,e,i,n){BHex.Axial.call(this,t,e),this.cost=i||1,this.blocked=!!n},BHex.Hexagon.prototype=BHex.Axial.prototype,BHex.Grid=function(t){this.radius=t||0,this.hexes=[];for(var e=-t;e<=t;e++)for(var i=-t;i<=t;i++)for(var n=-t;n<=t;n++)e+i+n==0&&this.hexes.push(new BHex.Hexagon(e,i))},BHex.Grid.prototype.getHexAt=function(t){var e;return this.hexes.some(function(i){if(i.compareTo(t))return e=i}),e},BHex.Grid.prototype.getNeighbors=function(t){var e=this,i=[];return[new BHex.Axial(t.x+1,t.y),new BHex.Axial(t.x+1,t.y-1),new BHex.Axial(t.x,t.y-1),new BHex.Axial(t.x-1,t.y),new BHex.Axial(t.x-1,t.y+1),new BHex.Axial(t.x,t.y+1)].forEach(function(t){var n=e.getHexAt(t);n&&i.push(n)}),i},BHex.Grid.prototype.getDistance=function(t,e){return(Math.abs(t.x-e.x)+Math.abs(t.x+t.y-e.x-e.y)+Math.abs(t.y-e.y))/2},BHex.Grid.Search=BHex.Grid.Search||{},BHex.Grid.Search.Heap=function(){if(!BinaryHeap)throw new Error("BinaryHeap was not found.");return new BinaryHeap(function(t){return t.F})},BHex.Grid.Search.Node=function(t,e,i,n){this.hex=t,this.parent=this.G=this.H=this.F=null,this.rescore(e,i,n)},BHex.Grid.Search.Node.prototype.rescore=function(t,e,i){this.parent=t,this.G=e,this.H=i||0,this.F=this.G+this.H},BHex.Grid.prototype.getLine=function(t,e){if(t.compareTo(e))return[];var i=function(t,e,i){return new BHex.Cube(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i,t.z+(e.z-t.z)*i)},n=this.getDistance(t,e),r=[],o=[],h=t.toCube(),s=e.toCube(),a=e.toCube();s.x-=1e-6,s.y-=1e-6,s.z+=2e-6,a.x+=1e-6,a.y+=1e-6,a.z-=2e-6;for(var x=0;x<=n;x++){var c=i(h,s,1/n*x).round().toAxial(),u=this.getHexAt(c);if(!t.compareTo(u)){if(u.blocked)break;r.push(u)}}for(x=0;x<=n;x++){c=i(h,a,1/n*x).round().toAxial(),u=this.getHexAt(c);if(!t.compareTo(u)){if(u.blocked)break;o.push(u)}}return r.length>o.length?r:o},BHex.Grid.prototype.getRange=function(t,e,i){var n=BHex.Grid.Search.Heap(),r={},o={};for(n.push(new BHex.Grid.Search.Node(t,null,0));n.size()>0;){var h=n.pop();r[h.hex.getKey()]=h.hex;this.getNeighbors(h.hex).forEach(function(t){if(!(!i&&t.blocked||r[t.getKey()])){var s=h.G+(i?1:t.cost),a=o[t.getKey()];if(s<=e&&(!a||s<a.G)){if(a)a.rescore(h,s,0),n.rescoreElement(a);else{var x=new BHex.Grid.Search.Node(t,h,s,0);o[t.getKey()]=x,n.push(x)}}}})}var s=[];for(var a in o)o.hasOwnProperty(a)&&s.push(o[a].hex);return s},BHex.Grid.prototype.findPath=function(t,e){var i=this,n=new BHex.Grid.Search.Heap,r={},o={};for(n.push(new BHex.Grid.Search.Node(t,null,0,i.getDistance(t,e)));n.size()>0;){var h=n.pop();if(h.hex.compareTo(e)){for(var s=[];h.parent;)s.push(h),h=h.parent;return s.map(function(t){return t.hex}).reverse()}r[h.hex.getKey()]=h;i.getNeighbors(h.hex).forEach(function(t){if(!t.blocked&&!r[t.getKey()]){var s=h.G+t.cost,a=o[t.getKey()];if(!a||s<a.G){var x=i.getDistance(t,e);if(a)a.rescore(h,s,x),n.rescoreElement(a);else{var c=new BHex.Grid.Search.Node(t,h,s,x);r[c.hex.getKey()]=c,n.push(c)}}}})}return[]},module.exports=BHex,BHex.Hexagon.prototype.center=null,BHex.Hexagon.prototype.points=null,BHex.Cube.prototype.round=function(){var t=this.x,e=this.y,i=this.z;this.x=Math.round(t),this.y=Math.round(e),this.z=Math.round(i);var n=Math.abs(this.x-t),r=Math.abs(this.y-e),o=Math.abs(this.z-i);return n>r&&n>o?this.x=-this.y-this.z:r>o?this.y=-this.x-this.z:this.z=-this.x-this.y,this},BHex.Drawing=BHex.Drawing||{},BHex.Drawing.Drawing=function(t,e){this.grid=t,this.options=e,this.grid.hexes.forEach(function(t){t.center=BHex.Drawing.Drawing.getCenter(t,e),t.points=BHex.Drawing.Drawing.getCorners(t.center,e)})},BHex.Drawing.Drawing.getCorners=function(t,e){for(var i=[],n=0;n<6;n++)i.push(BHex.Drawing.Drawing.getCorner(t,e,n));return i},BHex.Drawing.Drawing.getCorner=function(t,e,i){var n=60*i+(e.orientation==BHex.Drawing.Static.Orientation.PointyTop?90:0),r=Math.PI/180*n;return new BHex.Drawing.Point(Math.round(t.x+e.size*Math.cos(r)),Math.round(t.y+e.size*Math.sin(r)))},BHex.Drawing.Drawing.getCenter=function(t,e){var i=0,n=0,r=t.toCube();return e.orientation==BHex.Drawing.Static.Orientation.FlatTop?(i=r.x*e.width*3/4,n=(r.z+r.x/2)*e.height):(i=(r.x+r.z/2)*e.width,n=r.z*e.height*3/4),new BHex.Drawing.Point(Math.round(i),Math.round(n))},BHex.Drawing.Drawing.prototype.getHexAt=function(t){var e,i;this.options.orientation==BHex.Drawing.Static.Orientation.FlatTop?(e=2*t.x/3/this.options.size,i=(-t.x/3+Math.sqrt(3)/3*t.y)/this.options.size):(e=(t.x*Math.sqrt(3)/3-t.y/3)/this.options.size,i=2*t.y/3/this.options.size);var n=new BHex.Axial(e,i).toCube().round().toAxial();return this.grid.getHexAt(n)},BHex.Drawing.Static={Orientation:{FlatTop:1,PointyTop:2}},BHex.Drawing.Point=function(t,e){this.x=t,this.y=e},BHex.Drawing.Options=function(t,e,i){this.size=t,this.orientation=e||BHex.Drawing.Static.Orientation.FlatTop,this.center=i||new BHex.Drawing.Point(0,0),this.orientation==BHex.Drawing.Static.Orientation.FlatTop?(this.width=2*t,this.height=Math.sqrt(3)/2*this.width):(this.height=2*t,this.width=Math.sqrt(3)/2*this.height)};